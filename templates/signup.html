<!DOCTYPE html>
<html>
<head>
  <title>TradeEra - Registration</title>
  <style>
    body {
      background: #22293f;
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    .container {
      width: 420px;
      margin: 56px auto;
      background: #132338;
      border-radius: 14px;
      box-shadow: 0 0 32px #0007;
      padding: 32px 38px 30px 38px;
      color: #eaf1fa;
    }
    .header {
      text-align: center;
      margin-bottom: 18px;
    }
    .header h1 {
      font-size: 2.1em;
      font-weight: bold;
      color: #ffb24d;
      margin-bottom: 0;
      letter-spacing: 1.2px;
    }
    .header .subtitle {
      font-size: 1.13em;
      font-weight: 400;
      color: #ececec;
      margin-bottom: 10px;
      margin-top: 4px;
    }
    label {
      font-weight: 600;
      margin-top: 18px;
      margin-bottom: 4px;
      display: block;
    }
    .input-row {
      display: flex;
      gap: 16px;
    }
    .input-row input, .input-row select {
      flex:1;
    }
    input, select {
      font-size: 1em;
      margin-bottom: 14px;
      padding: 9px;
      width: 100%;
      border-radius: 6px;
      border: 1px solid #435c8d;
      background: #192645;
      color: #f8f8f8;
      transition: border 0.2s;
    }
    input:focus, select:focus {
      outline: none;
      border: 1.5px solid #ffb24d;
    }
    .actions {
      display: flex;
      gap: 16px;
      margin-top: 22px;
      justify-content: flex-end;
    }
    .actions button {
      padding: 12px 32px;
      font-size: 1em;
      font-weight: bold;
      border-radius: 7px;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    .actions .register-btn {
      background: #ffb24d;
      color: #22293f;
    }
    .actions .cancel-btn {
      background: #37476a;
      color: #eaf1fa;
    }
    .info-text {
      font-size: 0.95em;
      margin-bottom: 9px;
      color: #8aa0c6;
    }
    .referral-row {
      display:flex;
      align-items:center;
      gap:6px;
    }
    #copyReferral {
      padding:8px 16px;
      font-size:0.95em;
      background:#ffb24d;
      color:#132338;
      border:none;
      border-radius:5px;
      cursor:pointer;
      font-weight:bold;
    }
    #copyReferral:hover {
      background:#ffd999;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>TRADEERA</h1>
      <div class="subtitle">New Registration</div>
    </div>
    <form id="signupForm">
      <label>Referral Code Information</label>
      <div class="info-text">Enter your referral code to register</div>
      <div class="referral-row">
        <input name="referral_code" id="referralCode" required>
        <button type="button" id="copyReferral">Copy</button>
      </div>

      <label>Select Position</label>
      <select name="position" required>
        <option value="LEFT">LEFT</option>
        <option value="RIGHT">RIGHT</option>
      </select>

      <label>Create Login Information</label>
      <input name="username" placeholder="Enter Username" required>
      <div class="input-row">
        <input name="password" type="password" placeholder="Enter Password" required>
        <input name="confirm_password" type="password" placeholder="Confirm Password" required>
      </div>

      <label>Personal Information</label>
      <div class="input-row">
        <input name="first_name" placeholder="First name" required>
        <input name="last_name" placeholder="Last name" required>
      </div>
      <div class="input-row">
        <input name="email" type="email" placeholder="Email" required>
        <input name="dob" type="date" placeholder="DOB" required>
      </div>
      <div class="input-row">
        <select name="country" id="countrySelect" required>
          <option value="">--Select Country--</option>
          <option value="India" data-code="+91">India (+91)</option>
          <option value="USA" data-code="+1">USA (+1)</option>
          <option value="UK" data-code="+44">UK (+44)</option>
          <option value="Australia" data-code="+61">Australia (+61)</option>
          <option value="Canada" data-code="+1">Canada (+1)</option>
          <option value="Lithuania" data-code="+370">Lithuania (+370)</option>
          <option value="Germany" data-code="+49">Germany (+49)</option>
          <option value="France" data-code="+33">France (+33)</option>
          <option value="Other" data-code="">Other</option>
        </select>
        <input name="country_code" id="countryCode" placeholder="Code" readonly required>
        <input name="mobile" placeholder="Mobile" required>
      </div>
      <input name="state" placeholder="State" required>
      <div class="actions">
        <button class="register-btn" type="submit">Register</button>
        <button class="cancel-btn" type="button" onclick="window.location.href='/'">Cancel</button>
      </div>
    </form>
  </div>
  <script>
    // Autofill referral code from URL parameter (readonly if present)
    function getQueryParam(param) {
      let params = new URLSearchParams(window.location.search);
      return params.get(param);
    }
    window.onload = function() {
      let referral = getQueryParam('referral');
      let refInput = document.getElementById('referralCode');
      if (referral) {
        refInput.value = referral;
        refInput.readOnly = true;
      } else {
        refInput.readOnly = false;
      }
    };

    // Copy referral code
    document.getElementById('copyReferral').onclick = function() {
      let refCode = document.getElementById('referralCode').value;
      if (refCode) {
        navigator.clipboard.writeText(refCode);
        alert("Referral code copied!");
      } else {
        alert("Nothing to copy!");
      }
    };

    // Auto-fill country dial code
    document.getElementById('countrySelect').addEventListener('change', function(e) {
      let code = e.target.options[e.target.selectedIndex].getAttribute('data-code');
      document.getElementById('countryCode').value = code || '';
    });

    document.getElementById('signupForm').onsubmit = async function(e) {
      e.preventDefault();
      let form = e.target;
      if(form.password.value !== form.confirm_password.value){
        alert("Passwords do not match."); return;
      }
      let fields = {};
      Array.from(form.elements).forEach(el => {
        if(el.name && el.type!=="button") fields[el.name] = el.value;
      });
      let res = await fetch('/signup', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(fields)
      });
      let data = await res.json();
      if (data.user_id) {
        alert('Registration successful! Your User ID is: ' + data.user_id);
        window.location.href = '/';
      } else {
        alert(data.message);
      }
    };
  </script>
</body>
</html>
