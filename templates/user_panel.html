<!DOCTYPE html>
<html>
<head>
  <title>TradeEra User Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700&display=swap" rel="stylesheet">
  <style>
    html, body { margin: 0; padding: 0; height: 100%; background: #f6f7fa; overflow-x:hidden;}
    body { font-family: 'Nunito', Arial, sans-serif; color: #222d41; min-height: 100vh; }

    .header { width:100vw; height:67px; position:fixed; left:0; top:0; z-index:900; background:#fff; border-bottom:1.5px solid #e4e4f0; display:flex; align-items:center; }
    .header-logo-area { flex-shrink:0; display:flex; align-items:center; height:67px; padding-left:21px;}
    .logo-svg { width:43px; height:43px; margin-right:10px; background:#f7fff3; border-radius:11px; display:inline-block; box-shadow:0 0 4px #d9f7e7;}
    .logo-text { font-size:2em; letter-spacing:.05em; font-weight:700; color:#14a074;}
    .header-status-box { flex-shrink:0; display:flex; align-items:center; margin-left:18px; gap:7px; background:#edfff9; border-radius:99px; padding:2.5px 18px 2.5px 11px; font-size:1.14em; font-weight:600; color:#16915d; border:1.4px solid #e2f6ec;}
    .status-dot { width:17px; height:17px; display:inline-block; background:#36d96e; border-radius:50%; border:2.5px solid #e6fbe7;}
    .header-profile { margin-left:auto; margin-right:30px; position:relative; display:flex; align-items:center;}
    .profile-avatar-btn { border:none; background:none; padding:0; margin-left:10px; border-radius:50%; cursor:pointer; width:43px; height:43px; }
    .profile-avatar { width:41px; height:41px; border-radius:50%; object-fit:cover; border:2px solid #e9fbe5; background:#f5fff9;}
    .profile-dropdown { display:none; position:absolute; top:56px; right:0; background:#fff; border-radius:12px; box-shadow:0 2px 36px #baf6de24,0 1px 6px #bbb3; min-width:150px; padding:7px 0; border:1.5px solid #eafceb; z-index:999; }
    .profile-avatar-btn.active + .profile-dropdown {display:block;}
    .profile-dropdown-item { width:100%; padding:11px 17px; color:#248865; background:none; border:none; font-size:1.08em;text-align:left; border-radius:7px; cursor:pointer; font-weight:600; transition:background .12s;}
    .profile-dropdown-item:hover { background:#e8fcec; color:#177e54;}
    .header .hamburger { display:none;background:none;border:none;width:42px;height:100%;align-items:center;justify-content:center;cursor:pointer;z-index:999; margin-left:8px; position:relative;}
    .hamburger-inner, .hamburger-inner:before, .hamburger-inner:after { position:absolute; left: 8px; width: 28px; height: 4px; border-radius: 2px; background: #1975d3; content: ""; transition: all .22s; display: block;}
    .hamburger-inner { top: 29px;}
    .hamburger-inner:before{ content:""; top: -9px;}
    .hamburger-inner:after { content:""; top: 9px;}
    .hamburger.active .hamburger-inner { background: transparent;}
    .hamburger.active .hamburger-inner:before { top: 0; transform: rotate(44deg);}
    .hamburger.active .hamburger-inner:after  { top: 0; transform: rotate(-44deg);}
    @media (max-width:950px){ .logo-text { font-size: 1.32em;} .header .hamburger { display: flex;} .header-profile { margin-right: 10px;} .header-logo-area {padding-left:7px;} .logo-svg {width:35px;height:35px;} }
    .sidebar { width:265px; background:#fafdfe; color:#273042; height:100vh; position:fixed; left:0; top:0; font-size:1.05em; box-shadow:0 0 18px #03101309; border-right:1.5px solid #e6e7ea; z-index:850; padding-top:67px; display:flex; flex-direction:column; transition: left .32s cubic-bezier(.4,0,.2,1); overflow: hidden; }
    .sidebar-inner { display: flex; flex-direction: column; height: calc(100vh - 67px); overflow: hidden;}
    .sidebar-menu-scroll { flex:1 1 auto; min-height: 0; overflow-y: auto !important; overflow-x: hidden !important; padding-bottom: 10px; height: 100%; scrollbar-color: #b1f2d7 #e9fbe5; scrollbar-width: thin;}
    .sidebar-menu-scroll::-webkit-scrollbar {width:7px; background:#e9fbe5; border-radius:8px;}
    .sidebar-menu-scroll::-webkit-scrollbar-thumb {background:#b1f2d7;border-radius:7px;}
    .sb-logo-row {display:flex; align-items:center; gap:8px; margin:0 0 7px 0;}
    .sb-logo-svg { width: 31px; height: 31px; background: #e8fff1; border-radius: 8px; display: inline-block; margin-left:9px;}
    .sb-logo-text { font-size:1.1em; font-weight:700; color:#11a874;}
    .sb-menu { list-style:none; margin:0; padding:0 0 9px 0;}
    .sb-menu > li, .sb-menu > li.has-dropdown, .dropdown li { padding:12px 30px; font-weight:500; color:#222d41; border:none; border-radius:8px; margin:1px 7px; font-size:1em; position:relative; user-select:none; transition:background .11s, color .14s; cursor:pointer !important; -webkit-tap-highlight-color:transparent !important;}
    .sb-menu > li.active, .sb-menu > li.open, .sb-menu > li:hover, .dropdown li:active, .dropdown li:focus, .dropdown li:hover { background: #c0fae6; color: #178c85 !important;}
    .sb-menu > li.has-dropdown::after { content: 'â–¸'; font-size: .96em; float: right; color: #a2b7bb;}
    .sb-menu > li.has-dropdown.open::after { content: 'â–¾'; }
    .sb-menu > li.has-dropdown > .dropdown { display: none;}
    .sb-menu > li.has-dropdown.open > .dropdown { display: block;}
    .dropdown { background: none; margin: 0; box-shadow: none; border-radius: 0; padding: 2px 0 2px 13px;}
    .dropdown li { color: #7a849b; font-size: 1em; font-weight: 400; background: none; border-radius: 7px; padding: 8px 7px 8px 14px; margin: 2px 0;}
    .sb-footer { flex-shrink: 0; position: static; margin: 10px 0 7px 30px; font-size:.98em; color: #bbb; cursor: default !important; pointer-events: none; user-select: none;}
    @media (max-width:950px){ .sidebar { left: -290px; width: 235px; min-height: 100vh; padding-top: 67px; box-shadow: 2px 0 30px #aaf6;} .sidebar.open { left:0;} }
    .sidebar-backdrop { display: none; position: fixed; z-index: 600; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(9,24,45,0.11);}
    .sidebar-backdrop.show { display: block;}

    .main-content { margin-left: 265px; padding-top: 82px; padding-bottom: 28px; min-width: 320px; background: #f8fafd; transition: margin 0.3s; position: relative; }
    @media (max-width:950px){ .main-content { margin-left:0; padding-top:87px;} }
    .ref-card { width:99.5%; background:#fff; min-height:44px; display:flex; flex-direction:column; align-items:flex-start; padding:19px 4vw 17px 4vw; box-shadow:0 1.5px 13px #dde7ff12; border-radius:17px; margin:22px 0 18px 0; font-size:1.14em; gap:10px;}
    .ref-block-row { width:100%; display:flex; align-items: center; }
    .ref-link-title {font-weight:700; color:#1d61a4; margin-right:6px;}
    .ref-url {font-size:1em; color:#4d6ea5;}
    .ref-btn { margin-left:10px; padding:7px 15px; background:#e8efff; color:#1752c2; border:1.5px solid #dde6fa; border-radius:8px; font-weight:600; cursor:pointer;}
    .chart-section { width:98.2%; background:#d7f2fa; border-radius:20px; box-shadow:0 2px 15px #aecadd22; margin:15px auto 22px auto; min-height:370px; display:flex;flex-direction:column; align-items:center; padding:16px 0 7px 0; position:relative;z-index:1;}
    .chart-metrics { display:flex; justify-content:center; gap:39px; padding:17px 0 5px 0; font-size:1.18em; font-weight:600; letter-spacing:.01em; flex-wrap:wrap; }
    .chart-metrics div { color:#2650a0; min-width:135px;}
    .wallet-section-design {position:relative; width:98.2%; margin:0 auto 0 auto; z-index:0;}
    .wallet-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:24px; margin:0 auto 16px auto; width:100%; z-index:1; position:relative;}
    .wallet-box { background:#fff; border-radius:17px; box-shadow: 0 2px 17px #a9befb17,0 5px 14px #91f1ae09; display:flex; flex-direction:column; justify-content:space-between; padding:16px 19px 13px 22px; min-height:85px; position:relative; z-index:1;}
    .wallet-box-title { font-size:1.13em; font-weight:700; color:#1d2954; margin-bottom:5px;}
    .wallet-icon { color:#8259f2; font-size:1.35em; margin-right:7px;}
    .wallet-dollar { font-size:1.36em; font-weight:700; color:#223048; margin-bottom:2px;}
    .wallet-half-arc { position:absolute; right:16px; bottom:11px; width:33px; height:13px; border-bottom:3px solid #bbe5d7; border-radius:50%; opacity:.7;}
    @media (max-width:950px) { .wallet-grid { grid-template-columns:1fr !important;} }
    .split-row { display:flex; gap:20px; margin:19px auto 18px auto;width:98.3%; align-items:center; z-index:2; position:relative;}
    .income-bar, .withdraw-bar { display:flex; align-items:center; border-radius:0 0 15px 15px; min-height:55px;}
    .income-bar { flex:2.1;background:linear-gradient(90deg,#8af499 80%,#eaf8fb 100%); font-size:1.13em; font-weight:700; color:#1e944a; padding-left:28px; height:95px;}
    .withdraw-bar { flex:1.77;background:linear-gradient(to right,#f8c7e0 76%,#e9bbf7 100%); font-size:1.12em; font-weight:700; color:#a52479; padding-left:21px; height:95px;}
    .grid-3 { display: grid; grid-template-columns: 1.2fr 1fr .99fr; gap:15px; margin:15px auto 0 auto; width:98.5%;}
    .profile-info-card, .business-info-card, .income-info-card { background:#fff; border-radius:14px; box-shadow:0 2px 12px #ebf0fb17; padding:13px 17px 11px 14px; min-height:110px; display:flex;flex-direction:column;margin-bottom:7px; }
    .profile-info-top { display:flex; align-items:center;gap:10px;margin-bottom:5px;}
    .profile-pic {width:38px;height:38px;border-radius:50%;object-fit:cover;}
    .profile-main {display:flex;flex-direction:column;}
    .profile-name {font-weight:700;font-size:1.02em; color:#363870;}
    .profile-id {font-size:.92em; color:#859ebc;}
    .profile-list,.business-list,.income-list {list-style:none; margin:7px 0 0 0; padding:0;}
    .profile-list li {font-size:.90em; color:#5a5f6a;margin:2px 0;}
    .profile-label {color:#a7b0bf;min-width:97px;display:inline-block;}
    .profile-btn {margin-top:10px;padding:5px 12px;border:none;background:#255adc;color:#fff;font-weight:600;border-radius:6px;font-size:.95em;cursor:pointer;}
    .info-title {font-size:1.01em;font-weight:700;color:#2a3767;margin-bottom:4px;}
    .business-list li,.income-list li {font-size:.89em;display:flex;justify-content:space-between;color:#363d60;margin:2px 0;}
    .business-key,.income-key {color:#7b7e88;}
    .business-val,.income-val {font-weight:600;color:#313462;}

    /* Page Navigation */
    .page { display: none; }
    .page.active { display: block; }

    /* Table styles */
    table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 12px #ebf0fb17; }
    thead { background: linear-gradient(90deg, #14a074, #11a874); color: white; }
    th { padding: 15px; text-align: left; font-weight: 600; }
    td { padding: 12px 15px; border-bottom: 1px solid #e9fbe5; }
    tbody tr:hover { background: #f8fdfc; }
    .status-badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 0.85em; font-weight: 600; }
    .status-active { background: #d4f8e8; color: #16915d; }
    .status-inactive { background: #ffe6e6; color: #c41e3a; }

    @media (max-width:950px) { 
      .grid-3 { grid-template-columns: 1fr; } 
      .wallet-grid { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="header">
    <div class="header-logo-area">
      <span class="logo-svg">
        <svg viewBox="0 0 42 42" fill="none" style="width:100%;height:100%;">
          <rect x="7" y="16" width="28" height="15" rx="6" fill="#bef8d4" stroke="#14a074" stroke-width="2"/>
          <polyline points="13,26 20,20 26,27 34,18" fill="none" stroke="#14a074" stroke-width="2.3" stroke-linecap="round"/>
          <circle cx="13" cy="26" r="2" fill="#11a874"/>
          <circle cx="20" cy="20" r="2" fill="#14a074"/>
        </svg>
      </span>
      <span class="logo-text">TRADEERA</span>
    </div>
    <div class="header-status-box">
      <span class="status-dot"></span>
      Status Active
    </div>
    <div class="header-profile">
      <button type="button" class="profile-avatar-btn" id="profileAvatarBtn">
        <img class="profile-avatar" src="https://randomuser.me/api/portraits/men/31.jpg" alt="User">
      </button>
      <div class="profile-dropdown" id="profileDropdown">
        <button class="profile-dropdown-item" onclick="navigatePage('profile')">My Profile</button>
        <button class="profile-dropdown-item" onclick="logoutUser()">Logout</button>
      </div>
      <button class="hamburger" id="sidemenu-toggler" aria-label="Menu">
        <span class="hamburger-inner"></span>
        <span class="hamburger-inner"></span>
        <span class="hamburger-inner"></span>
      </button>
    </div>
  </div>
  <div class="sidebar-backdrop" id="sidebar-backdrop"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebarPanel">
    <div class="sidebar-inner">
      <div>
        <div class="sb-logo-row">
          <span class="sb-logo-svg">
            <svg viewBox="0 0 38 38" fill="none" style="width:100%;height:100%;">
              <rect x="6" y="14" width="24" height="11" rx="5" fill="#bef8d4" stroke="#14a074" stroke-width="1.6"/>
              <polyline points="11,22 16,17 22,23 29,15" fill="none" stroke="#14a074" stroke-width="2" stroke-linecap="round"/>
              <circle cx="11" cy="22" r="1.5" fill="#11a874"/>
              <circle cx="16" cy="17" r="1.5" fill="#14a074"/>
            </svg>
          </span>
          <span class="sb-logo-text">TRADEERA</span>
        </div>
        <div class="sidebar-menu-scroll">
          <ul class="sb-menu">
            <li class="active" onclick="navigatePage('dashboard')">Dashboard</li>
            <li onclick="navigatePage('registration')">New Registration</li>
            <li class="has-dropdown">Profile
              <ul class="dropdown">
                <li onclick="navigatePage('profile')">Manage Profile</li>
                <li onclick="navigatePage('changepassword')">Change Password</li>
              </ul>
            </li>
            <li class="has-dropdown">Community
              <ul class="dropdown">
                <li onclick="navigatePage('referrals')">Direct Referrals</li>
                <li onclick="navigatePage('team')">Total Team</li>
                <li onclick="navigatePage('tree')">Unilevel Tree</li>
              </ul>
            </li>
            <li class="has-dropdown">Income Wallet
              <ul class="dropdown">
                <li onclick="navigatePage('balance')">Balance</li>
                <li onclick="navigatePage('withdrawal')">Withdrawal</li>
                <li onclick="navigatePage('withdrawalhistory')">Withdrawal History</li>
              </ul>
            </li>
            <li class="has-dropdown">Income Report
              <ul class="dropdown">
                <li onclick="navigatePage('incomereport')">Income Report</li>
              </ul>
            </li>
            <li onclick="navigatePage('referrallink')">Referral Link</li>
            <li onclick="logoutUser()">Logout</li>
          </ul>
        </div>
      </div>
      <div class="sb-footer">Status: <span style="color:#8dfad1;">Active</span></div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <div class="main-content">
    
    <!-- DASHBOARD PAGE -->
    <div class="page active" id="dashboard-page">
      <div class="ref-card">
        <div class="ref-block-row">
          <span class="ref-link-title">Referral Link</span>
          <span class="ref-url" id="referralUrl"></span>
          <button class="ref-btn" onclick="copyReferral()">Copy</button>
        </div>
      </div>
      <div class="chart-section">
        <iframe src="https://s.tradingview.com/widgetembed/?symbol=BINANCE:BTCUSDT&interval=D&theme=Light&style=1&hidesidetoolbar=1" width="95%" height="270" frameborder="0" allowtransparency="true"></iframe>
        <div class="chart-metrics">
          <div>Investment <br><span id="investmentAmt" style="font-weight:400;">$0.00</span></div>
          <div>Today's Profit <br><span id="todayProfit" style="font-weight:400;">$0.00</span></div>
          <div>Total Profit 15 Days <br><span id="profit15" style="font-weight:400;">$0.00</span></div>
          <div>Total Profit <br><span id="totalProfit" style="font-weight:400;">$0.00</span></div>
        </div>
      </div>
      <div class="wallet-section-design">
        <div class="wallet-grid">
          <div class="wallet-box"><span class="wallet-box-title"><span class="wallet-icon">ðŸ’¼</span>Income Wallet</span><span class="wallet-dollar" id="incomeWallet">$0</span><span class="wallet-half-arc"></span></div>
          <div class="wallet-box"><span class="wallet-box-title"><span class="wallet-icon">ðŸ’¼</span>Trade Wallet</span><span class="wallet-dollar" id="tradeWallet">$0</span><span class="wallet-half-arc"></span></div>
          <div class="wallet-box"><span class="wallet-box-title"><span class="wallet-icon">ðŸ’¼</span>Activation Wallet</span><span class="wallet-dollar" id="activationWallet">$0</span><span class="wallet-half-arc"></span></div>
          <div class="wallet-box"><span class="wallet-box-title"><span class="wallet-icon">ðŸ’¼</span>Matching Income</span><span class="wallet-dollar" id="matchingIncome">$0</span><span class="wallet-half-arc"></span></div>
          <div class="wallet-box"><span class="wallet-box-title"><span class="wallet-icon">ðŸ’¼</span>Generation</span><span class="wallet-dollar" id="generationIncome">$0</span><span class="wallet-half-arc"></span></div>
          <div class="wallet-box"><span class="wallet-box-title"><span class="wallet-icon">ðŸ’¼</span>Club Income</span><span class="wallet-dollar" id="clubIncome">$0</span><span class="wallet-half-arc"></span></div>
          <div class="wallet-box"><span class="wallet-box-title"><span class="wallet-icon">ðŸ’¼</span>Trading Generation</span><span class="wallet-dollar" id="tradingGeneration">$0</span><span class="wallet-half-arc"></span></div>
          <div class="wallet-box"><span class="wallet-box-title"><span class="wallet-icon">ðŸ’¼</span>IB Income</span><span class="wallet-dollar" id="ibIncome">$0</span><span class="wallet-half-arc"></span></div>
        </div>
      </div>
      <div class="split-row">
        <div class="income-bar">Total Income&nbsp;&nbsp;<span id="totalIncome">$0</span></div>
        <div class="withdraw-bar">Total Withdraw&nbsp;&nbsp;<span id="totalWithdraw">$0</span></div>
      </div>
      <div class="grid-3">
        <div class="profile-info-card">
          <div class="profile-info-top">
            <img src="https://randomuser.me/api/portraits/men/31.jpg" class="profile-pic" alt="">
            <div class="profile-main">
              <span class="profile-name" id="userName"></span>
              <span class="profile-id" id="userId"></span>
            </div>
          </div>
          <ul class="profile-list">
            <li><span class="profile-label">Referral ID:</span> <span id="referralCode"></span></li>
            <li><span class="profile-label">Rank:</span> <span id="userRank">NA</span></li>
            <li><span class="profile-label">Date of Joining:</span> <span id="dateJoined"></span></li>
            <li><span class="profile-label">Date of Activation:</span> <span id="dateActivated"></span></li>
          </ul>
        </div>
        <div class="business-info-card">
          <div class="info-title">Business Details</div>
          <ul class="business-list">
            <li><span class="business-key">Direct Referrals</span><span class="business-val" id="directBot">0</span></li>
            <li><span class="business-key">Total Team</span><span class="business-val" id="totalBot">0</span></li>
            <li><span class="business-key">Left Leg</span><span class="business-val" id="leftLeg">0</span></li>
            <li><span class="business-key">Right Leg</span><span class="business-val" id="rightLeg">0</span></li>
          </ul>
        </div>
        <div class="income-info-card">
          <div class="info-title">Income Summary</div>
          <ul class="income-list">
            <li><span class="income-key">Wallet Balance</span><span class="income-val" id="balanceSummary">$0</span></li>
            <li><span class="income-key">Total Income</span><span class="income-val" id="totalIncSummary">$0</span></li>
            <li><span class="income-key">Commission</span><span class="income-val" id="commissionSummary">$0</span></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- REFERRALS PAGE -->
    <div class="page" id="referrals-page">
      <div style="margin:20px auto; width:98.5%; background:#fff; padding:20px; border-radius:14px; box-shadow:0 2px 12px #ebf0fb17;">
        <h2 style="color:#1d61a4; margin:0 0 15px 0;">My Direct Referrals</h2>
        <table>
          <thead>
            <tr>
              <th>Username</th>
              <th>Name</th>
              <th>Position</th>
              <th>Joining Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="referralsTable">
            <tr><td colspan="5" style="text-align:center;">Loading referrals...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- PROFILE PAGE -->
    <div class="page" id="profile-page">
      <div style="margin:20px auto; width:98.5%; background:#fff; padding:20px; border-radius:14px; box-shadow:0 2px 12px #ebf0fb17;">
        <h2 style="color:#1d61a4; margin:0 0 20px 0;">My Profile</h2>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
          <div>
            <label style="color:#666; font-weight:600;">Username</label>
            <input type="text" id="profUsername" readonly style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; margin-top:5px;">
          </div>
          <div>
            <label style="color:#666; font-weight:600;">Email</label>
            <input type="text" id="profEmail" readonly style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; margin-top:5px;">
          </div>
          <div>
            <label style="color:#666; font-weight:600;">Phone</label>
            <input type="text" id="profPhone" readonly style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; margin-top:5px;">
          </div>
          <div>
            <label style="color:#666; font-weight:600;">Country</label>
            <input type="text" id="profCountry" readonly style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; margin-top:5px;">
          </div>
          <div>
            <label style="color:#666; font-weight:600;">Referral Code</label>
            <input type="text" id="profReferralCode" readonly style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; margin-top:5px;">
          </div>
          <div>
            <label style="color:#666; font-weight:600;">Joining Date</label>
            <input type="text" id="profJoiningDate" readonly style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; margin-top:5px;">
          </div>
        </div>
      </div>
    </div>

    <!-- TREE VIEW PAGE -->
    <div class="page" id="tree-page">
      <div style="margin:20px auto; width:98.5%; background:#fff; padding:20px; border-radius:14px; box-shadow:0 2px 12px #ebf0fb17;">
        <h2 style="color:#1d61a4; margin:0 0 20px 0;">Binary Tree View</h2>
        <pre id="treeContent" style="background:#f5f5f5; padding:15px; border-radius:8px; overflow-x:auto;">Loading tree...</pre>
      </div>
    </div>

    <!-- PLACEHOLDER PAGES -->
    <div class="page" id="registration-page">
      <div style="margin:20px auto; width:98.5%; background:#fff; padding:40px; border-radius:14px; box-shadow:0 2px 12px #ebf0fb17; text-align:center;">
        <h2 style="color:#1d61a4;">New Registration</h2>
        <p style="color:#666; margin-top:20px;">Coming Soon...</p>
      </div>
    </div>

    <div class="page" id="changepassword-page">
      <div style="margin:20px auto; width:98.5%; background:#fff; padding:40px; border-radius:14px; box-shadow:0 2px 12px #ebf0fb17; text-align:center;">
        <h2 style="color:#1d61a4;">Change Password</h2>
        <p style="color:#666; margin-top:20px;">Coming Soon...</p>
      </div>
    </div>

    <div class="page" id="team-page">
      <div style="margin:20px auto; width:98.5%; background:#fff; padding:40px; border-radius:14px; box-shadow:0 2px 12px #ebf0fb17; text-align:center;">
        <h2 style="color:#1d61a4;">Total Team</h2>
        <p style="color:#666; margin-top:20px;">Coming Soon...</p>
      </div>
    </div>

    <div class="page" id="balance-page">
      <div style="margin:20px auto; width:98.5%; background:#fff; padding:40px; border-radius:14px; box-shadow:0 2px 12px #ebf0fb17; text-align:center;">
        <h2 style="color:#1d61a4;">Wallet Balance</h2>
        <p style="color:#666; margin-top:20px;">Coming Soon...</p>
      </div>
    </div>

    <div class="page" id="withdrawal-page">
      <div style="margin:20px auto; width:98.5%; background:#fff; padding:40px; border-radius:14px; box-shadow:0 2px 12px #ebf0fb17; text-align:center;">
        <h2 style="color:#1d61a4;">Withdrawal</h2>
        <p style="color:#666; margin-top:20px;">Coming Soon...</p>
      </div>
    </div>

    <div class="page" id="withdrawalhistory-page">
      <div style="margin:20px auto; width:98.5%; background:#fff; padding:40px; border-radius:14px; box-shadow:0 2px 12px #ebf0fb17; text-align:center;">
        <h2 style="color:#1d61a4;">Withdrawal History</h2>
        <p style="color:#666; margin-top:20px;">Coming Soon...</p>
      </div>
    </div>

    <div class="page" id="incomereport-page">
      <div style="margin:20px auto; width:98.5%; background:#fff; padding:40px; border-radius:14px; box-shadow:0 2px 12px #ebf0fb17; text-align:center;">
        <h2 style="color:#1d61a4;">Income Report</h2>
        <p style="color:#666; margin-top:20px;">Coming Soon...</p>
      </div>
    </div>

    <div class="page" id="referrallink-page">
      <div style="margin:20px auto; width:98.5%; background:#fff; padding:20px; border-radius:14px; box-shadow:0 2px 12px #ebf0fb17;">
        <h2 style="color:#1d61a4; margin:0 0 20px 0;">Referral Link</h2>
        <div style="background:#edfff9; padding:15px; border-radius:8px; border:1.5px solid #e2f6ec;">
          <label style="color:#666; font-weight:600; display:block; margin-bottom:10px;">Your Referral Link</label>
          <div style="display:flex; gap:10px;">
            <input type="text" id="refLinkInput" readonly style="flex:1; padding:10px; border:1px solid #ddd; border-radius:8px;">
            <button onclick="copyRefLink()" style="padding:10px 20px; background:#14a074; color:#fff; border:none; border-radius:8px; font-weight:600; cursor:pointer;">Copy</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- SCRIPTS -->
  <script>
    const API_BASE = window.location.origin;
    let currentUser = null;

    // ===== SIDEBAR & HEADER INTERACTIONS =====
    const sidebar = document.getElementById('sidebarPanel');
    const toggler = document.getElementById('sidemenu-toggler');
    const backdrop = document.getElementById('sidebar-backdrop');
    const profileBtn = document.getElementById('profileAvatarBtn');
    const profileDropdown = document.getElementById('profileDropdown');

    function hideSidebar() {
      sidebar.classList.remove('open');
      backdrop.classList.remove('show');
      toggler.classList.remove('active');
    }

    toggler.addEventListener('click', function(e) {
      e.stopPropagation();
      sidebar.classList.toggle('open');
      backdrop.classList.toggle('show');
      toggler.classList.toggle('active');
    });

    backdrop.addEventListener('click', hideSidebar);

    document.querySelectorAll('.sb-menu > li.has-dropdown').forEach(item => {
      item.addEventListener('click', function(e) {
        if(window.innerWidth < 951) e.stopPropagation();
        document.querySelectorAll('.sb-menu > li.has-dropdown').forEach(li => { if(li!==item) li.classList.remove('open'); });
        item.classList.toggle('open');
      });
    });

    profileBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      profileBtn.classList.toggle('active');
      setTimeout(() => { document.addEventListener('click', closeProfileDropdown, {once:true}); }, 10);
    });

    function closeProfileDropdown(e) {
      if(!profileBtn.contains(e.target) && !profileDropdown.contains(e.target)) {
        profileBtn.classList.remove('active');
      }
    }

    // ===== PAGE NAVIGATION =====
    function navigatePage(page) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(page + '-page').classList.add('active');
      hideSidebar();
      
      // Load data for specific pages
      if(page === 'referrals') loadReferrals();
      if(page === 'profile') loadProfilePage();
      if(page === 'tree') loadTreeView();
      if(page === 'referrallink') loadReferralLink();
    }

    // ===== LOAD USER PROFILE =====
    async function loadUserProfile() {
      try {
        const res = await fetch(API_BASE + '/api/user/profile', { credentials: 'include' });
        const data = await res.json();
        if (!data.success) {
          window.location.href = '/login';
          return;
        }
        currentUser = data.user;

        // Update Dashboard
        document.getElementById('userName').textContent = currentUser.first_name + ' ' + currentUser.last_name;
        document.getElementById('userId').textContent = currentUser.user_id;
        document.getElementById('referralCode').textContent = currentUser.referral_code;
        document.getElementById('dateJoined').textContent = new Date(currentUser.created_at).toLocaleDateString();
        document.getElementById('referralUrl').textContent = API_BASE + "/signup?referral=" + currentUser.referral_code;

        document.getElementById('incomeWallet').textContent = "$" + (currentUser.wallet_balance || 0).toFixed(2);
        document.getElementById('totalIncome').textContent = "$" + (currentUser.total_income || 0).toFixed(2);
        document.getElementById('balanceSummary').textContent = "$" + (currentUser.wallet_balance || 0).toFixed(2);
        document.getElementById('totalIncSummary').textContent = "$" + (currentUser.total_income || 0).toFixed(2);

      } catch (err) {
        console.error(err);
        window.location.href = '/login';
      }
    }

    async function loadReferrals() {
      try {
        const res = await fetch(API_BASE + '/api/user/referrals', { credentials: 'include' });
        const data = await res.json();
        if (!data.success) return;

        const tbody = document.getElementById('referralsTable');
        tbody.innerHTML = '';

        if(data.referrals.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No referrals yet</td></tr>';
          return;
        }

        data.referrals.forEach(ref => {
          const statusClass = ref.status === 'active' ? 'status-active' : 'status-inactive';
          const row = `<tr>
            <td>${ref.username}</td>
            <td>${ref.name}</td>
            <td>${ref.position}</td>
            <td>${new Date(ref.joined).toLocaleDateString()}</td>
            <td><span class="status-badge ${statusClass}">${ref.status}</span></td>
          </tr>`;
          tbody.innerHTML += row;
        });

        document.getElementById('directBot').textContent = data.direct_count;

      } catch (err) {
        console.error(err);
      }
    }

    async function loadProfilePage() {
      if(!currentUser) return;
      document.getElementById('profUsername').value = currentUser.username;
      document.getElementById('profEmail').value = currentUser.email;
      document.getElementById('profPhone').value = currentUser.phone || '-';
      document.getElementById('profCountry').value = currentUser.country || '-';
      document.getElementById('profReferralCode').value = currentUser.referral_code;
      document.getElementById('profJoiningDate').value = new Date(currentUser.created_at).toLocaleString();
    }

    async function loadTreeView() {
      try {
        const res = await fetch(API_BASE + '/api/user/tree', { credentials: 'include' });
        const data = await res.json();
        if (!data.success) return;

        const tree = data.tree;
        const treeText = JSON.stringify(tree, null, 2);
        document.getElementById('treeContent').textContent = treeText;

      } catch (err) {
        console.error(err);
      }
    }

    function loadReferralLink() {
      if(!currentUser) return;
      document.getElementById('refLinkInput').value = API_BASE + "/signup?referral=" + currentUser.referral_code;
    }

    function copyReferral() {
      const url = document.getElementById('referralUrl').textContent;
      navigator.clipboard.writeText(url);
      alert("Referral link copied!");
    }

    function copyRefLink() {
      const link = document.getElementById('refLinkInput');
      link.select();
      document.execCommand('copy');
      alert("Referral link copied!");
    }

    async function logoutUser() {
      await fetch(API_BASE + '/api/auth/logout', { method: 'POST', credentials: 'include' });
      window.location.href = '/login';
    }

    // Load on page load
    window.addEventListener('DOMContentLoaded', loadUserProfile);
  </script>
</body>
</html>
